var z=Object.defineProperty;var J=(e,n,i)=>n in e?z(e,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[n]=i;var P=(e,n,i)=>J(e,typeof n!="symbol"?n+"":n,i);import{h as E,ac as I,ab as $,aU as Q,G as N,a1 as Y,aa as X,a2 as Z,a0 as B,a5 as tt,aV as q,o as x,c as D,F as U,A as T,v as A,w as j,a as y,b as R,I as C,t as H,y as V,j as et}from"./C4oi7rqb.js";import{_ as at}from"./DoWI4-x-.js";import{_ as st}from"./CSiqqgES.js";import{u as ot}from"./DW00qQ9v.js";import"./DfHeqBD8.js";import{C as S,L as nt,b as rt,p as lt,a as dt,B as ct,c as it,d as ut,e as pt,P as ft}from"./BnavYg6K.js";import"./CofNhih0.js";import"./C8OBkV36.js";import"./C9mN9a5t.js";const F={data:{type:Object,required:!0},options:{type:Object,default:()=>({})},plugins:{type:Array,default:()=>[]},datasetIdKey:{type:String,default:"label"},updateMode:{type:String,default:void 0}},mt={ariaLabel:{type:String},ariaDescribedby:{type:String}},ht={type:{type:String,required:!0},destroyDelay:{type:Number,default:0},...F,...mt},bt=Q[0]==="2"?(e,n)=>Object.assign(e,{attrs:n}):(e,n)=>Object.assign(e,n);function L(e){return q(e)?B(e):e}function yt(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e;return q(n)?new Proxy(e,{}):e}function gt(e,n){const i=e.options;i&&n&&Object.assign(i,n)}function G(e,n){e.labels=n}function K(e,n,i){const g=[];e.datasets=n.map(f=>{const u=e.datasets.find(_=>_[i]===f[i]);return!u||!f.data||g.includes(u)?{...f}:(g.push(u),Object.assign(u,f),u)})}function vt(e,n){const i={labels:[],datasets:[]};return G(i,e.labels),K(i,e.datasets,n),i}const xt=E({props:ht,setup(e,n){let{expose:i,slots:g}=n;const f=N(null),u=I(null);i({chart:u});const _=()=>{if(!f.value)return;const{type:m,data:w,options:v,plugins:h,datasetIdKey:p}=e,s=vt(w,p),a=yt(s,w);u.value=new S(f.value,{type:m,data:a,options:{...v},plugins:h})},M=()=>{const m=B(u.value);m&&(e.destroyDelay>0?setTimeout(()=>{m.destroy(),u.value=null},e.destroyDelay):(m.destroy(),u.value=null))},k=m=>{m.update(e.updateMode)};return Y(_),X(M),Z([()=>e.options,()=>e.data],(m,w)=>{let[v,h]=m,[p,s]=w;const a=B(u.value);if(!a)return;let o=!1;if(v){const b=L(v),d=L(p);b&&b!==d&&(gt(a,b),o=!0)}if(h){const b=L(h.labels),d=L(s.labels),l=L(h.datasets),t=L(s.datasets);b!==d&&(G(a.config.data,b),o=!0),l&&l!==t&&(K(a.config.data,l,e.datasetIdKey),o=!0)}o&&tt(()=>{k(a)})},{deep:!0}),()=>$("canvas",{role:"img",ariaLabel:e.ariaLabel,ariaDescribedby:e.ariaDescribedby,ref:f},[$("p",{},[g.default?g.default():""])])}});function _t(e,n){return S.register(n),E({props:F,setup(i,g){let{expose:f}=g;const u=I(null),_=M=>{u.value=M==null?void 0:M.chart};return f({chart:u}),()=>$(xt,bt({ref:_},{type:e,...i}))}})}const W=_t("line",nt),Mt={class:"flex flex-col gap-4"},Ot={class:"flex justify-between"},wt=y("div",{class:"flex items-end gap-2"},[y("h2",{class:"text-xl font-semibold"},"Heart Rate"),y("span",{class:"text-xs mb-0.5 text-gray-500"},"(bpm)")],-1),Dt={class:"flex justify-around mb-6"},Lt={class:"text-center"},jt={class:"mb-2"},Ct={class:"text-5xl"},Pt=y("div",{class:"flex items-end gap-2"},[y("h2",{class:"text-xl font-semibold"},"Electrocardiogram"),y("span",{class:"text-xs mb-0.5 text-gray-500"},"(mV)")],-1),Rt={key:0},kt=y("div",{class:"h-[600px] w-full rounded-lg bg-gray-100 dark:bg-gray-900 p-4 flex flex-col gap-4"},[y("div",{class:"h-[50px] w-full rounded-lg bg-gray-300 dark:bg-gray-700 animate-pulse"}),y("div",{class:"flex-1 w-full rounded-lg bg-gray-300 dark:bg-gray-700 animate-pulse"})],-1),Ut=[kt],Nt=E({__name:"DetailWidget",props:{data:{type:Object,required:!0}},setup(e){S.register(rt,lt,dt,ct,it,ut,pt,ft);const n={responsive:!0},i=e,g=ot(),f=()=>{const p=150+Math.floor(Math.random()*105),s=150+Math.floor(Math.random()*105),a=150+Math.floor(Math.random()*105);return`rgb(${p}, ${s}, ${a})`};class u{constructor(){P(this,"type","")}parse(...h){return{stats:[],type:this.type,labels:[],datasets:[{label:"",data:[]}],yMin:0,yMax:0}}}class _ extends u{constructor(){super(...arguments);P(this,"type","hr")}parse(p){const s=[];for(const t of p)for(const[r,c]of t.value)typeof r=="number"&&!s.includes(r)&&s.push(r);const a=[];for(const t of p){const r={data:{},borderColor:f(),label:t.device,tension:0,borderWidth:2,fill:"start",hidden:!0};for(const[c,O]of t.value)typeof c=="number"&&s.includes(c)&&(r.data[c]=O);a.push(r)}const o={data:{},borderColor:f(),label:"Merged",tension:0,borderWidth:2,fill:"start"};for(const t of s){const r=a.map(c=>c.data[t]||0);o.data[t]=r.reduce((c,O)=>c+O,0)/r.length}a.unshift(o);let b="second";s[s.length-1]>100&&(b="minute");const d=[];if(b==="second")for(const t of s)d.push(g().startOf("day").add(t,"second").format("s")+"s");else for(const t of s)d.push(g().startOf("day").add(t,"second").format("mm:ss"));const l=[{label:"Min",value:0},{label:"Avg",value:0},{label:"Max",value:0}];{const t=Object.values(o.data);l[0].value=Math.round(Math.min(...t)),l[1].value=Math.round(t.reduce((r,c)=>r+c,0)/t.length),l[2].value=Math.round(Math.max(...t))}return{type:this.type,stats:l,labels:d,datasets:a.map(t=>({...t,data:Object.values(t.data)})),yMin:Math.min(...a.map(t=>Math.min(...Object.values(t.data)))),yMax:Math.max(...a.map(t=>Math.max(...Object.values(t.data))))}}}class M extends u{constructor(){super(...arguments);P(this,"type","ecg")}parse(p){const s=[];for(const t of p)for(const[r,c]of t.value)typeof r=="number"&&!s.includes(r)&&s.push(r);const a=[];for(const t of p){const r={data:{},borderColor:f(),label:t.device,tension:0,borderWidth:2,fill:"start",hidden:!0};for(const[c,O]of t.value)typeof c=="number"&&s.includes(c)&&(r.data[c]=O);a.push(r)}const o={data:{},borderColor:f(),label:"Merged",tension:0,borderWidth:2,fill:"start"};for(const t of s){const r=a.map(c=>c.data[t]||0);o.data[t]=r.reduce((c,O)=>c+O,0)/r.length}a.unshift(o);let b="second";s[s.length-1]>100&&(b="minute");const d=[];if(b==="second")for(const t of s)d.push(g().startOf("day").add(t,"second").format("s")+"s");else for(const t of s)d.push(g().startOf("day").add(t,"second").format("mm:ss"));const l=[{label:"Min",value:0},{label:"Avg",value:0},{label:"Max",value:0}];{const t=Object.values(o.data);l[0].value=Math.round(Math.min(...t)),l[1].value=Math.round(t.reduce((r,c)=>r+c,0)/t.length),l[2].value=Math.round(Math.max(...t))}return{type:this.type,labels:d,stats:l,datasets:a.map(t=>({...t,data:Object.values(t.data)})),yMin:Math.min(...a.map(t=>Math.min(...Object.values(t.data)))),yMax:Math.max(...a.map(t=>Math.max(...Object.values(t.data))))}}}const k=()=>{const v=i.data.report,h=[new _,new M],p=[];for(const s of v.reports){const a=h.find(o=>o.type===s.type);if(a){const o=a.parse(s.data);p.push(o)}}return p},m=N([]);Y(()=>{setTimeout(async()=>{m.value=k()},1e3)});const w=(v,h="Merged",p="csv")=>{{const s=m.value.find(a=>a.type==="hr");if(s){const a=s.datasets.find(r=>r.label===h);if(!a)throw new Error("Device not found");const o=s.labels.map((r,c)=>[r,a.data[c]]),b=[["Time","Heart Rate"],...o].map(r=>r.join(",")).join(`
`),d=new Blob([b],{type:"text/csv"}),l=URL.createObjectURL(d),t=document.createElement("a");t.href=l,t.download=`heart_rate_${h}_${g().format("YYYYMMDD_HHmmss")}.csv`,t.click(),URL.revokeObjectURL(l)}}};return(v,h)=>{const p=et,s=at,a=st;return x(),D("div",Mt,[(x(!0),D(U,null,T(C(m),(o,b)=>(x(),D(U,null,[o.type=="hr"?(x(),A(a,{key:0},{header:j(()=>{var d;return[y("div",Ot,[wt,y("div",null,[R(s,{items:[[...(((d=C(m).find(l=>l.type==="hr"))==null?void 0:d.datasets)||[]).map(l=>l.label).map(l=>({label:`csv ${l}`,icon:"i-heroicons-arrow-down-tray",click:()=>w("hr",l,"csv")}))]]},{default:j(()=>[R(p,{icon:"i-heroicons-bars-3-bottom-right",variant:"soft"})]),_:2},1032,["items"])])])]}),default:j(()=>[y("div",Dt,[(x(!0),D(U,null,T(o.stats,(d,l)=>(x(),D("div",Lt,[y("div",jt,H(d.label),1),y("div",Ct,H(d.value),1)]))),256))]),R(C(W),{options:{...n,elements:{point:{radius:0,hitRadius:0}},scales:{x:{ticks:{maxTicksLimit:10,maxRotation:0,minRotation:0}},y:{suggestedMin:o.yMin-20,suggestedMax:o.yMax+20}}},data:{labels:o.labels,datasets:[...o.datasets.map(d=>({...d}))]}},null,8,["options","data"])]),_:2},1024)):o.type=="ecg"?(x(),A(a,{key:1},{header:j(()=>[Pt]),default:j(()=>[R(C(W),{options:{...n,elements:{point:{radius:0,hitRadius:0}},scales:{x:{ticks:{maxTicksLimit:10,maxRotation:0,minRotation:0}},y:{suggestedMin:o.yMin,suggestedMax:o.yMax}}},data:{labels:o.labels,datasets:[...o.datasets.map(d=>({...d}))]}},null,8,["options","data"])]),_:2},1024)):V("",!0)],64))),256)),C(m).length==0?(x(),D("div",Rt,Ut)):V("",!0)])}}});export{Nt as default};
