var W=Object.defineProperty;var T=(h,i,b)=>i in h?W(h,i,{enumerable:!0,configurable:!0,writable:!0,value:b}):h[i]=b;var k=(h,i,b)=>(T(h,typeof i!="symbol"?i+"":i,b),b);import{h as V,H as Y,a0 as N,o as m,c as v,F as O,B as L,x as C,w as x,a as d,b as w,I as M,t as D,y as B,k as S}from"./BD7xl8KE.js";import{_ as A}from"./CUDSmfko.js";import{_ as F}from"./DXTYQLUp.js";import{u as q}from"./B1j37sz0.js";import{C as G,b as I,p as z,a as J,B as K,c as Q,L as X,d as Z,P as tt,e as E}from"./DxgJsb7L.js";import"./CEJKJ8XJ.js";import"./Be98tHGm.js";import"./1csrZc7B.js";const et={class:"flex flex-col gap-4"},at={class:"flex justify-between"},st=d("div",{class:"flex items-end gap-2"},[d("h2",{class:"text-xl font-semibold"},"Heart Rate"),d("span",{class:"text-xs mb-0.5 text-gray-500"},"(bpm)")],-1),ot={class:"flex justify-around mb-6"},nt={class:"text-center"},rt={class:"mb-2"},lt={class:"text-5xl"},dt=d("div",{class:"flex items-end gap-2"},[d("h2",{class:"text-xl font-semibold"},"Electrocardiogram"),d("span",{class:"text-xs mb-0.5 text-gray-500"},"(mV)")],-1),ct={key:0},it=d("div",{class:"h-[600px] w-full rounded-lg bg-gray-100 dark:bg-gray-900 p-4 flex flex-col gap-4"},[d("div",{class:"h-[50px] w-full rounded-lg bg-gray-300 dark:bg-gray-700 animate-pulse"}),d("div",{class:"flex-1 w-full rounded-lg bg-gray-300 dark:bg-gray-700 animate-pulse"})],-1),ut=[it],xt=V({__name:"DetailWidget",props:{data:{type:Object,required:!0}},setup(h){G.register(I,z,J,K,Q,X,Z,tt);const i={responsive:!0},b=h,_=q(),j=()=>{const c=150+Math.floor(Math.random()*105),a=150+Math.floor(Math.random()*105),s=150+Math.floor(Math.random()*105);return`rgb(${c}, ${a}, ${s})`};class R{constructor(){k(this,"type","")}parse(...u){return{stats:[],type:this.type,labels:[],datasets:[{label:"",data:[]}],yMin:0,yMax:0}}}class U extends R{constructor(){super(...arguments);k(this,"type","hr")}parse(c){const a=[];for(const t of c)for(const[e,n]of t.value)typeof e=="number"&&!a.includes(e)&&a.push(e);const s=[];for(const t of c){const e={data:{},borderColor:j(),label:t.device,tension:0,borderWidth:2,fill:"start",hidden:!0};for(const[n,g]of t.value)typeof n=="number"&&a.includes(n)&&(e.data[n]=g);s.push(e)}const o={data:{},borderColor:j(),label:"Merged",tension:0,borderWidth:2,fill:"start"};for(const t of a){const e=s.map(n=>n.data[t]||0);o.data[t]=e.reduce((n,g)=>n+g,0)/e.length}s.unshift(o);let f="second";a[a.length-1]>100&&(f="minute");const l=[];if(f==="second")for(const t of a)l.push(_().startOf("day").add(t,"second").format("s")+"s");else for(const t of a)l.push(_().startOf("day").add(t,"second").format("mm:ss"));const r=[{label:"Min",value:0},{label:"Avg",value:0},{label:"Max",value:0}];{const t=Object.values(o.data);r[0].value=Math.round(Math.min(...t)),r[1].value=Math.round(t.reduce((e,n)=>e+n,0)/t.length),r[2].value=Math.round(Math.max(...t))}return{type:this.type,stats:r,labels:l,datasets:s.map(t=>({...t,data:Object.values(t.data)})),yMin:Math.min(...s.map(t=>Math.min(...Object.values(t.data)))),yMax:Math.max(...s.map(t=>Math.max(...Object.values(t.data))))}}}class $ extends R{constructor(){super(...arguments);k(this,"type","ecg")}parse(c){const a=[];for(const t of c)for(const[e,n]of t.value)typeof e=="number"&&!a.includes(e)&&a.push(e);const s=[];for(const t of c){const e={data:{},borderColor:j(),label:t.device,tension:0,borderWidth:2,fill:"start",hidden:!0};for(const[n,g]of t.value)typeof n=="number"&&a.includes(n)&&(e.data[n]=g);s.push(e)}const o={data:{},borderColor:j(),label:"Merged",tension:0,borderWidth:2,fill:"start"};for(const t of a){const e=s.map(n=>n.data[t]||0);o.data[t]=e.reduce((n,g)=>n+g,0)/e.length}s.unshift(o);let f="second";a[a.length-1]>100&&(f="minute");const l=[];if(f==="second")for(const t of a)l.push(_().startOf("day").add(t,"second").format("s")+"s");else for(const t of a)l.push(_().startOf("day").add(t,"second").format("mm:ss"));const r=[{label:"Min",value:0},{label:"Avg",value:0},{label:"Max",value:0}];{const t=Object.values(o.data);r[0].value=Math.round(Math.min(...t)),r[1].value=Math.round(t.reduce((e,n)=>e+n,0)/t.length),r[2].value=Math.round(Math.max(...t))}return{type:this.type,labels:l,stats:r,datasets:s.map(t=>({...t,data:Object.values(t.data)})),yMin:Math.min(...s.map(t=>Math.min(...Object.values(t.data)))),yMax:Math.max(...s.map(t=>Math.max(...Object.values(t.data))))}}}const H=()=>{const p=b.data.report,u=[new U,new $],c=[];for(const a of p.reports){const s=u.find(o=>o.type===a.type);if(s){const o=s.parse(a.data);c.push(o)}}return c},y=Y([]);N(()=>{setTimeout(async()=>{y.value=H()},1e3)});const P=(p,u="Merged",c="csv")=>{{const a=y.value.find(s=>s.type==="hr");if(a){const s=a.datasets.find(e=>e.label===u);if(!s)throw new Error("Device not found");const o=a.labels.map((e,n)=>[e,s.data[n]]),f=[["Time","Heart Rate"],...o].map(e=>e.join(",")).join(`
`),l=new Blob([f],{type:"text/csv"}),r=URL.createObjectURL(l),t=document.createElement("a");t.href=r,t.download=`heart_rate_${u}_${_().format("YYYYMMDD_HHmmss")}.csv`,t.click(),URL.revokeObjectURL(r)}}};return(p,u)=>{const c=S,a=A,s=F;return m(),v("div",et,[(m(!0),v(O,null,L(M(y),(o,f)=>(m(),v(O,null,[o.type=="hr"?(m(),C(s,{key:0},{header:x(()=>{var l;return[d("div",at,[st,d("div",null,[w(a,{items:[[...(((l=M(y).find(r=>r.type==="hr"))==null?void 0:l.datasets)||[]).map(r=>r.label).map(r=>({label:`csv ${r}`,icon:"i-heroicons-arrow-down-tray",click:()=>P("hr",r,"csv")}))]]},{default:x(()=>[w(c,{icon:"i-heroicons-bars-3-bottom-right",variant:"soft"})]),_:2},1032,["items"])])])]}),default:x(()=>[d("div",ot,[(m(!0),v(O,null,L(o.stats,(l,r)=>(m(),v("div",nt,[d("div",rt,D(l.label),1),d("div",lt,D(l.value),1)]))),256))]),w(M(E),{options:{...i,elements:{point:{radius:0,hitRadius:0}},scales:{x:{ticks:{maxTicksLimit:10,maxRotation:0,minRotation:0}},y:{suggestedMin:o.yMin-20,suggestedMax:o.yMax+20}}},data:{labels:o.labels,datasets:[...o.datasets.map(l=>({...l}))]}},null,8,["options","data"])]),_:2},1024)):o.type=="ecg"?(m(),C(s,{key:1},{header:x(()=>[dt]),default:x(()=>[w(M(E),{options:{...i,elements:{point:{radius:0,hitRadius:0}},scales:{x:{ticks:{maxTicksLimit:10,maxRotation:0,minRotation:0}},y:{suggestedMin:o.yMin,suggestedMax:o.yMax}}},data:{labels:o.labels,datasets:[...o.datasets.map(l=>({...l}))]}},null,8,["options","data"])]),_:2},1024)):B("",!0)],64))),256)),M(y).length==0?(m(),v("div",ct,ut)):B("",!0)])}}});export{xt as default};
